if not game:IsLoaded() then
    game.Loaded:Wait()
end

pcall(function()
    game.CoreGui["ShiftLockGUI"]:Destroy()
end)

local ShiftlockGui = Instance.new("ScreenGui")
ShiftlockGui.Name = "ShiftLockGUI"
ShiftlockGui.Parent = game.CoreGui
ShiftlockGui.ResetOnSpawn = false

local Button = Instance.new("ImageButton")
Button.Parent = ShiftlockGui
Button.BackgroundTransparency = 1
Button.Size = UDim2.new(0, 70, 0, 70)
Button.Position = UDim2.new(0.9, 0, 0.5, 0)
Button.Image = "rbxasset://textures/ui/mouseLock_off@2x.png"
Button.Active = true
Button.Draggable = true 

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local root = character:WaitForChild("HumanoidRootPart")
local camera = workspace.CurrentCamera

local MAX_LENGTH = 999999
local ENABLED_OFFSET = CFrame.new(1.7, 0, 0)
local DISABLED_OFFSET = CFrame.new(-1.7, 0, 0)
local isEnabled = false
local connection

local function UpdateButton(state)
    if state then
        Button.Image = "rbxasset://textures/ui/mouseLock_on@2x.png"
    else
        Button.Image = "rbxasset://textures/ui/mouseLock_off@2x.png"
    end
end

local function EnableShiftlock()
    if isEnabled then return end
    isEnabled = true
    UpdateButton(true)
    humanoid.AutoRotate = false
    connection = RunService.RenderStepped:Connect(function()
        local camCF = CFrame.new(root.Position, root.Position + Vector3.new(camera.CFrame.LookVector.X * MAX_LENGTH, 0, camera.CFrame.LookVector.Z * MAX_LENGTH))
        root.CFrame = camCF
        camera.CFrame = camera.CFrame * ENABLED_OFFSET
    end)
end

local function DisableShiftlock()
    if not isEnabled then return end
    isEnabled = false
    UpdateButton(false)
    humanoid.AutoRotate = true
    if connection then
        connection:Disconnect()
        connection = nil
    end
end

Button.MouseButton1Click:Connect(function()
    if isEnabled then
        DisableShiftlock()
    else
        EnableShiftlock()
    end
end)

player.CharacterAdded:Connect(function(newChar)
    character = newChar
    humanoid = character:WaitForChild("Humanoid")
    root = character:WaitForChild("HumanoidRootPart")
    DisableShiftlock()
end)
